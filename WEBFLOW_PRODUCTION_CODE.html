<!-- ðŸš€ PRODUCTION WEBFLOW CODE FOR JAGCODEDEVOPS.XYZ ðŸš€ -->
<!-- Copy this ENTIRE code into Webflow Site Settings > Custom Code > Head Code -->

<!-- Load Appwrite SDK -->
<script src="https://cdn.jsdelivr.net/npm/appwrite@16.0.2/dist/iife/sdk.js"></script>

<!-- JagCode Configuration -->
<script>
  window.JAGCODE_CONFIG = {
    endpoint: 'https://syd.cloud.appwrite.io/v1',
    projectId: '68a36f6c002bfc1e6057',
    databaseId: 'main',
    environment: 'production',
    
    // Collection IDs
    collections: {
      users: '68a3b34a00375e270b15',
      portfolios: '68a3b3e2000dcc682c12', 
      transactions: '68a3b41400346ff40705',
      activity: '68a3b43e001c44090ac6',
      settings: '68a3b463003bb9695087'
    },
    
    storageId: 'main-storage',
    storageBucket: '68a3b5b80038da178baf',
    
    realtime: {
      enabled: true,
      heartbeat: 30000
    }
  };
</script>

<!-- JagCode SDK -->
<script>
  class JagCodeSDK {
    constructor() {
      this.client = null;
      this.account = null;
      this.databases = null;
      this.config = {};
      this.user = null;
      this.initialized = false;
    }

    async init(config) {
      try {
        this.config = config;
        this.client = new Appwrite.Client()
          .setEndpoint(config.endpoint)
          .setProject(config.projectId);
        
        this.account = new Appwrite.Account(this.client);
        this.databases = new Appwrite.Databases(this.client);

        try {
          this.user = await this.account.get();
        } catch (error) {
          this.user = null;
        }

        this.initialized = true;
        return this;
      } catch (error) {
        console.error('SDK initialization failed:', error);
        throw error;
      }
    }

    auth = {
      signUp: async (email, password, name) => {
        try {
          const user = await this.account.create(Appwrite.ID.unique(), email, password, name);
          
          await this.databases.createDocument(
            this.config.databaseId,
            this.config.collections.users,
            user.$id,
            {
              name,
              email,
              createdAt: new Date().toISOString(),
              updatedAt: new Date().toISOString()
            }
          );

          this.user = user;
          return user;
        } catch (error) {
          throw error;
        }
      },

      signIn: async (email, password) => {
        try {
          const session = await this.account.createEmailPasswordSession(email, password);
          this.user = await this.account.get();
          return { user: this.user, session };
        } catch (error) {
          throw error;
        }
      },

      signOut: async () => {
        try {
          await this.account.deleteSession('current');
          this.user = null;
          return true;
        } catch (error) {
          throw error;
        }
      },

      getCurrentUser: () => {
        return this.user;
      },

      isAuthenticated: () => {
        return !!this.user;
      }
    };

    portfolio = {
      get: async (userId) => {
        const targetUserId = userId || this.user?.$id;
        if (!targetUserId) throw new Error('User not authenticated');

        try {
          const portfolios = await this.databases.listDocuments(
            this.config.databaseId,
            this.config.collections.portfolios,
            [Appwrite.Query.equal('userId', targetUserId)]
          );

          return portfolios.documents.length > 0 ? portfolios.documents[0] : null;
        } catch (error) {
          throw error;
        }
      }
    };

    transactions = {
      list: async (userId, limit = 10) => {
        const targetUserId = userId || this.user?.$id;
        if (!targetUserId) throw new Error('User not authenticated');

        try {
          const transactions = await this.databases.listDocuments(
            this.config.databaseId,
            this.config.collections.transactions,
            [
              Appwrite.Query.equal('userId', targetUserId),
              Appwrite.Query.orderDesc('timestamp'),
              Appwrite.Query.limit(limit)
            ]
          );

          return transactions.documents;
        } catch (error) {
          throw error;
        }
      }
    };

    activity = {
      list: async (userId, limit = 10) => {
        const targetUserId = userId || this.user?.$id;
        if (!targetUserId) throw new Error('User not authenticated');

        try {
          const activities = await this.databases.listDocuments(
            this.config.databaseId,
            this.config.collections.activity,
            [
              Appwrite.Query.equal('userId', targetUserId),
              Appwrite.Query.orderDesc('timestamp'),
              Appwrite.Query.limit(limit)
            ]
          );

          return activities.documents;
        } catch (error) {
          throw error;
        }
      }
    };

    utils = {
      formatCurrency: (amount, currency = 'USD') => {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency
        }).format(amount);
      },

      formatDate: (date) => {
        return new Intl.DateTimeFormat('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }).format(new Date(date));
      }
    };
  }

  window.JagCodeSDK = JagCodeSDK;
</script>

<!-- Main Application -->
<script>
  let jagcode;

  document.addEventListener('DOMContentLoaded', async function() {
    console.log('ðŸš€ Initializing JagCode SDK...');
    
    try {
      jagcode = new JagCodeSDK();
      await jagcode.init(window.JAGCODE_CONFIG);
      
      console.log('âœ… JagCode SDK initialized successfully');
      
      const user = jagcode.auth.getCurrentUser();
      if (user) {
        console.log('ðŸ‘¤ User authenticated:', user.name);
        showAuthenticatedContent(user);
        await loadDashboard(user);
      } else {
        console.log('ðŸ” No authenticated user');
        showPublicContent();
      }
      
    } catch (error) {
      console.error('âŒ SDK initialization failed:', error);
      showError('Failed to connect. Please refresh the page.');
    }
  });

  function showAuthenticatedContent(user) {
    hideElements('[data-auth="login-form"]');
    hideElements('[data-auth="signup-form"]');
    hideElements('[data-auth="public"]');
    
    showElements('[data-auth="authenticated"]');
    showElements('[data-dashboard]');
    
    updateTextContent('[data-user="name"]', user.name);
    updateTextContent('[data-user="email"]', user.email);
  }

  function showPublicContent() {
    showElements('[data-auth="login-form"]');
    showElements('[data-auth="signup-form"]');
    showElements('[data-auth="public"]');
    
    hideElements('[data-auth="authenticated"]');
    hideElements('[data-dashboard]');
  }

  async function loadDashboard(user) {
    console.log('ðŸ“Š Loading dashboard...');
    
    try {
      const portfolio = await jagcode.portfolio.get(user.$id);
      if (portfolio) {
        updateTextContent('[data-portfolio="total-value"]', 
          jagcode.utils.formatCurrency(portfolio.totalValue || 0));
        updateTextContent('[data-portfolio="last-updated"]', 
          jagcode.utils.formatDate(portfolio.lastUpdated));
      } else {
        updateTextContent('[data-portfolio="total-value"]', '$0.00');
        updateTextContent('[data-portfolio="last-updated"]', 'Never');
      }
    } catch (error) {
      console.error('Error loading portfolio:', error);
    }

    try {
      const transactions = await jagcode.transactions.list(user.$id, 5);
      console.log('ðŸ’³ Loaded transactions:', transactions.length);
    } catch (error) {
      console.error('Error loading transactions:', error);
    }

    try {
      const activities = await jagcode.activity.list(user.$id, 5);
      console.log('ðŸ“ Loaded activities:', activities.length);
    } catch (error) {
      console.error('Error loading activities:', error);
    }
  }

  // Form Handlers
  window.handleSignup = async function(event) {
    event.preventDefault();
    const form = event.target;
    const email = form.querySelector('[data-field="email"]').value;
    const password = form.querySelector('[data-field="password"]').value;
    const name = form.querySelector('[data-field="name"]').value;
    
    try {
      showLoading(form);
      const user = await jagcode.auth.signUp(email, password, name);
      console.log('âœ… User signed up:', user.name);
      showAuthenticatedContent(user);
      await loadDashboard(user);
      showSuccess('Account created successfully!');
    } catch (error) {
      console.error('âŒ Signup failed:', error);
      showError(error.message || 'Signup failed. Please try again.');
    } finally {
      hideLoading(form);
    }
  };

  window.handleSignin = async function(event) {
    event.preventDefault();
    const form = event.target;
    const email = form.querySelector('[data-field="email"]').value;
    const password = form.querySelector('[data-field="password"]').value;
    
    try {
      showLoading(form);
      const result = await jagcode.auth.signIn(email, password);
      console.log('âœ… User signed in:', result.user.name);
      showAuthenticatedContent(result.user);
      await loadDashboard(result.user);
      showSuccess('Welcome back!');
    } catch (error) {
      console.error('âŒ Signin failed:', error);
      showError(error.message || 'Login failed. Please check your credentials.');
    } finally {
      hideLoading(form);
    }
  };

  window.handleSignout = async function() {
    try {
      await jagcode.auth.signOut();
      console.log('âœ… User signed out');
      showPublicContent();
      showSuccess('Signed out successfully');
    } catch (error) {
      console.error('âŒ Signout failed:', error);
      showError('Failed to sign out. Please try again.');
    }
  };

  // Utility Functions
  function hideElements(selector) {
    document.querySelectorAll(selector).forEach(el => el.style.display = 'none');
  }

  function showElements(selector) {
    document.querySelectorAll(selector).forEach(el => el.style.display = 'block');
  }

  function updateTextContent(selector, text) {
    document.querySelectorAll(selector).forEach(el => el.textContent = text);
  }

  function showLoading(form) {
    form.classList.add('jagcode-loading');
    const button = form.querySelector('input[type="submit"], button[type="submit"]');
    if (button) button.disabled = true;
  }

  function hideLoading(form) {
    form.classList.remove('jagcode-loading');
    const button = form.querySelector('input[type="submit"], button[type="submit"]');
    if (button) button.disabled = false;
  }

  function showError(message) {
    console.error('ðŸ”´', message);
    const errorElements = document.querySelectorAll('[data-message="error"]');
    errorElements.forEach(el => {
      el.textContent = message;
      el.style.display = 'block';
    });
    
    setTimeout(() => {
      errorElements.forEach(el => el.style.display = 'none');
    }, 5000);
  }

  function showSuccess(message) {
    console.log('ðŸŸ¢', message);
    const successElements = document.querySelectorAll('[data-message="success"]');
    successElements.forEach(el => {
      el.textContent = message;
      el.style.display = 'block';
    });
    
    setTimeout(() => {
      successElements.forEach(el => el.style.display = 'none');
    }, 3000);
  }
</script>

<!-- Styles -->
<style>
  [data-auth="authenticated"] {
    display: none;
  }
  
  .jagcode-loading {
    opacity: 0.6;
    pointer-events: none;
  }
  
  [data-message="error"] {
    display: none;
    color: #ef4444;
    background: #fee2e2;
    padding: 12px;
    border-radius: 6px;
    margin: 8px 0;
    border: 1px solid #fecaca;
  }
  
  [data-message="success"] {
    display: none;
    color: #059669;
    background: #d1fae5;
    padding: 12px;
    border-radius: 6px;
    margin: 8px 0;
    border: 1px solid #a7f3d0;
  }
</style>

<!-- END PRODUCTION CODE -->
