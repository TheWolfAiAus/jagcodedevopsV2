<!-- 🚀 PRODUCTION WEBFLOW CODE FOR JAGCODEDEVOPS.XYZ 🚀 -->
<!-- Copy this ENTIRE code into Webflow Site Settings > Custom Code > Head Code -->

<script>
  window.JAGCODE_CONFIG = {
    endpoint: 'https://syd.cloud.appwrite.io/v1',
    projectId: '68a36f6c002bfc1e6057',
    databaseId: 'main',
    environment: 'production',
    
    // Collection IDs from your .env
    collections: {
      users: '68a3b34a00375e270b15',
      portfolios: '68a3b3e2000dcc682c12', 
      transactions: '68a3b41400346ff40705',
      activity: '68a3b43e001c44090ac6',
      settings: '68a3b463003bb9695087'
    },
    
    // Storage and Functions
    storageId: 'main-storage',
    storageBucket: '68a3b5b80038da178baf',
    
    // Domain configuration
    domains: {
      webflow: 'jagecodedevops.webflow.io',
      production: 'jagcodedevops.xyz',
      productionWww: 'www.jagcodedevops.xyz'
    },
    
    // Real-time features
    realtime: {
      enabled: true,
      heartbeat: 30000
    }
  };
</script>

<!-- Load JagCode SDK -->
<script src="https://cdn.jsdelivr.net/gh/TheWolfAiAus/jagcodedeveopsV2@main/web/sdk/jagcode-sdk.js"></script>

<!-- Initialize SDK when page loads -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 Initializing JagCode SDK for production...');
    
    // Initialize JagCode SDK
    window.jagcode = new JagCodeSDK();
    
    window.jagcode.init(window.JAGCODE_CONFIG).then(() => {
      console.log('✅ JagCode SDK initialized successfully');
      console.log('🔗 Connected to Appwrite:', window.JAGCODE_CONFIG.endpoint);
      console.log('📊 Project ID:', window.JAGCODE_CONFIG.projectId);
      
      // Check if user is already authenticated
      const user = window.jagcode.auth.getCurrentUser();
      if (user) {
        console.log('👤 User authenticated:', user.name);
        showAuthenticatedContent(user);
        initializeDashboard(user);
      } else {
        console.log('🔐 No authenticated user, showing public content');
        showPublicContent();
      }
      
      // Initialize real-time if enabled
      if (window.JAGCODE_CONFIG.realtime.enabled) {
        initializeRealtime();
      }
      
    }).catch(error => {
      console.error('❌ JagCode SDK initialization failed:', error);
      showError('Connection failed. Please check your internet connection.');
    });
  });

  // Authentication UI Management
  function showAuthenticatedContent(user) {
    // Hide login/signup forms
    hideElements('[data-auth="login-form"]');
    hideElements('[data-auth="signup-form"]');
    hideElements('[data-auth="public"]');
    
    // Show authenticated content
    showElements('[data-auth="authenticated"]');
    showElements('[data-dashboard]');
    
    // Update user name displays
    updateTextContent('[data-user="name"]', user.name);
    updateTextContent('[data-user="email"]', user.email);
    
    // Load user data
    loadUserDashboard(user);
  }

  function showPublicContent() {
    // Show login/signup forms
    showElements('[data-auth="login-form"]');
    showElements('[data-auth="signup-form"]');
    showElements('[data-auth="public"]');
    
    // Hide authenticated content
    hideElements('[data-auth="authenticated"]');
    hideElements('[data-dashboard]');
  }

  // Dashboard Initialization
  function initializeDashboard(user) {
    console.log('📊 Initializing dashboard for user:', user.name);
    
    // Load portfolio data
    loadPortfolio(user.$id);
    
    // Load recent transactions
    loadTransactions(user.$id);
    
    // Load recent activity
    loadActivity(user.$id);
    
    // Start real-time updates
    startRealTimeUpdates(user.$id);
  }

  async function loadPortfolio(userId) {
    try {
      const portfolio = await window.jagcode.portfolio.get(userId);
      
      if (portfolio) {
        updateTextContent('[data-portfolio="total-value"]', 
          window.jagcode.utils.formatCurrency(portfolio.totalValue || 0));
        
        // Parse and display assets
        if (portfolio.assets) {
          const assets = typeof portfolio.assets === 'string' 
            ? JSON.parse(portfolio.assets) 
            : portfolio.assets;
          displayAssets(assets);
        }
        
        updateTextContent('[data-portfolio="last-updated"]', 
          window.jagcode.utils.formatDate(portfolio.lastUpdated));
      } else {
        updateTextContent('[data-portfolio="total-value"]', '$0.00');
        updateTextContent('[data-portfolio="last-updated"]', 'Never');
      }
    } catch (error) {
      console.error('Error loading portfolio:', error);
      showError('Failed to load portfolio data');
    }
  }

  async function loadTransactions(userId) {
    try {
      const transactions = await window.jagcode.transactions.list(userId, 10);
      displayTransactions(transactions);
    } catch (error) {
      console.error('Error loading transactions:', error);
      showError('Failed to load transaction data');
    }
  }

  async function loadActivity(userId) {
    try {
      const activities = await window.jagcode.activity.list(userId, 10);
      displayActivities(activities);
    } catch (error) {
      console.error('Error loading activities:', error);
      showError('Failed to load activity data');
    }
  }

  // Real-time Updates
  function initializeRealtime() {
    console.log('🔄 Initializing real-time connection...');
    
    window.jagcode.realtime.connect().then(() => {
      updateConnectionStatus('Connected');
      console.log('✅ Real-time connection established');
    }).catch(error => {
      updateConnectionStatus('Disconnected');
      console.error('❌ Real-time connection failed:', error);
    });
  }

  function startRealTimeUpdates(userId) {
    console.log('📡 Starting real-time updates for user:', userId);
    
    window.jagcode.realtime.subscribeToUser(userId, {
      onPortfolioUpdate: (portfolio) => {
        console.log('📊 Portfolio updated:', portfolio);
        updateTextContent('[data-portfolio="total-value"]', 
          window.jagcode.utils.formatCurrency(portfolio.totalValue || 0));
        updateTextContent('[data-portfolio="last-updated"]', 
          window.jagcode.utils.formatDate(portfolio.lastUpdated));
      },
      
      onTransactionUpdate: (transaction) => {
        console.log('💳 New transaction:', transaction);
        loadTransactions(userId); // Refresh transactions
      },
      
      onActivityUpdate: (activity) => {
        console.log('📝 New activity:', activity);
        loadActivity(userId); // Refresh activities
      },
      
      onConnect: () => {
        updateConnectionStatus('Connected');
        console.log('🔗 Real-time connected');
      },
      
      onDisconnect: () => {
        updateConnectionStatus('Disconnected');
        console.log('🔌 Real-time disconnected');
      },
      
      onError: (error) => {
        updateConnectionStatus('Error');
        console.error('⚠️ Real-time error:', error);
      }
    });
  }

  // Form Handlers - Add these to your Webflow forms
  window.handleSignup = async function(event) {
    event.preventDefault();
    const form = event.target;
    const email = form.querySelector('[data-field="email"]').value;
    const password = form.querySelector('[data-field="password"]').value;
    const name = form.querySelector('[data-field="name"]').value;
    
    try {
      showLoading(form);
      const user = await window.jagcode.auth.signUp(email, password, name);
      console.log('✅ User signed up:', user);
      showAuthenticatedContent(user);
      initializeDashboard(user);
      showSuccess('Account created successfully!');
    } catch (error) {
      console.error('❌ Signup failed:', error);
      showError(error.message || 'Signup failed. Please try again.');
    } finally {
      hideLoading(form);
    }
  };

  window.handleSignin = async function(event) {
    event.preventDefault();
    const form = event.target;
    const email = form.querySelector('[data-field="email"]').value;
    const password = form.querySelector('[data-field="password"]').value;
    
    try {
      showLoading(form);
      const result = await window.jagcode.auth.signIn(email, password);
      console.log('✅ User signed in:', result.user);
      showAuthenticatedContent(result.user);
      initializeDashboard(result.user);
      showSuccess('Welcome back!');
    } catch (error) {
      console.error('❌ Signin failed:', error);
      showError(error.message || 'Login failed. Please check your credentials.');
    } finally {
      hideLoading(form);
    }
  };

  window.handleSignout = async function() {
    try {
      await window.jagcode.auth.signOut();
      console.log('✅ User signed out');
      showPublicContent();
      showSuccess('You have been signed out successfully');
    } catch (error) {
      console.error('❌ Signout failed:', error);
      showError('Failed to sign out. Please try again.');
    }
  };

  // Utility Functions
  function hideElements(selector) {
    document.querySelectorAll(selector).forEach(el => el.style.display = 'none');
  }

  function showElements(selector) {
    document.querySelectorAll(selector).forEach(el => el.style.display = 'block');
  }

  function updateTextContent(selector, text) {
    document.querySelectorAll(selector).forEach(el => el.textContent = text);
  }

  function updateConnectionStatus(status) {
    updateTextContent('[data-status="realtime"]', status);
    const elements = document.querySelectorAll('[data-status="realtime"]');
    elements.forEach(el => {
      el.className = `connection-status ${status.toLowerCase()}`;
    });
  }

  function showLoading(form) {
    form.classList.add('jagcode-loading');
  }

  function hideLoading(form) {
    form.classList.remove('jagcode-loading');
  }

  function showError(message) {
    console.error('🔴', message);
    // You can customize this to show errors in your UI
    const errorElements = document.querySelectorAll('[data-message="error"]');
    errorElements.forEach(el => {
      el.textContent = message;
      el.style.display = 'block';
    });
    
    setTimeout(() => {
      errorElements.forEach(el => el.style.display = 'none');
    }, 5000);
  }

  function showSuccess(message) {
    console.log('🟢', message);
    // You can customize this to show success messages in your UI
    const successElements = document.querySelectorAll('[data-message="success"]');
    successElements.forEach(el => {
      el.textContent = message;
      el.style.display = 'block';
    });
    
    setTimeout(() => {
      successElements.forEach(el => el.style.display = 'none');
    }, 3000);
  }

  function displayAssets(assets) {
    // Customize this based on your Webflow structure
    console.log('💎 Assets:', assets);
  }

  function displayTransactions(transactions) {
    // Customize this based on your Webflow structure
    console.log('💳 Transactions:', transactions);
  }

  function displayActivities(activities) {
    // Customize this based on your Webflow structure  
    console.log('📝 Activities:', activities);
  }
</script>

<!-- Custom CSS for JagCode Integration -->
<style>
  [data-auth="authenticated"] {
    display: none;
  }
  
  .jagcode-loading {
    opacity: 0.6;
    pointer-events: none;
  }
  
  .jagcode-error {
    color: #ef4444;
    font-size: 14px;
    margin-top: 8px;
  }
  
  .jagcode-success {
    color: #10b981;
    font-size: 14px;
    margin-top: 8px;
  }
  
  .connection-status.connected {
    color: #10b981;
  }
  
  .connection-status.disconnected {
    color: #ef4444;
  }
  
  .connection-status.error {
    color: #f59e0b;
  }
  
  [data-message="error"] {
    display: none;
    color: #ef4444;
    background: #fee2e2;
    padding: 12px;
    border-radius: 6px;
    margin: 8px 0;
  }
  
  [data-message="success"] {
    display: none;
    color: #059669;
    background: #d1fae5;
    padding: 12px;
    border-radius: 6px;
    margin: 8px 0;
  }
</style>

<!-- END PRODUCTION CODE -->
