<!-- JagCode Webflow Form Examples -->
<!-- Add these examples to your Webflow pages -->

<!-- LOGIN FORM EXAMPLE -->
<div data-auth="login-form" class="login-form-wrapper">
  <h2>Sign In</h2>
  <form id="jagcode-login-form" class="login-form">
    <div class="form-field">
      <label for="login-email">Email</label>
      <input type="email" id="login-email" name="email" required>
    </div>
    
    <div class="form-field">
      <label for="login-password">Password</label>
      <input type="password" id="login-password" name="password" required>
    </div>
    
    <button type="submit" class="btn btn-primary">Sign In</button>
    <div id="login-message" class="message"></div>
  </form>
</div>

<!-- SIGNUP FORM EXAMPLE -->
<div data-auth="signup-form" class="signup-form-wrapper">
  <h2>Create Account</h2>
  <form id="jagcode-signup-form" class="signup-form">
    <div class="form-field">
      <label for="signup-name">Full Name</label>
      <input type="text" id="signup-name" name="name" required>
    </div>
    
    <div class="form-field">
      <label for="signup-email">Email</label>
      <input type="email" id="signup-email" name="email" required>
    </div>
    
    <div class="form-field">
      <label for="signup-password">Password</label>
      <input type="password" id="signup-password" name="password" required minlength="8">
    </div>
    
    <button type="submit" class="btn btn-primary">Create Account</button>
    <div id="signup-message" class="message"></div>
  </form>
</div>

<!-- AUTHENTICATED USER CONTENT -->
<div data-auth="authenticated" class="user-dashboard">
  <div class="user-header">
    <h2>Welcome, <span data-user="name">User</span>!</h2>
    <button id="jagcode-signout" class="btn btn-secondary">Sign Out</button>
  </div>
  
  <div class="user-portfolio">
    <h3>Portfolio Overview</h3>
    <div id="portfolio-data" class="portfolio-container">
      <div class="loading">Loading portfolio...</div>
    </div>
  </div>
  
  <div class="user-transactions">
    <h3>Recent Transactions</h3>
    <div id="transactions-data" class="transactions-container">
      <div class="loading">Loading transactions...</div>
    </div>
  </div>
</div>

<!-- WALLET CONNECT SECTION -->
<div data-auth="authenticated" class="wallet-section">
  <h3>Wallet Integration</h3>
  <form id="wallet-connect-form">
    <div class="form-field">
      <label for="wallet-address">Wallet Address</label>
      <input type="text" id="wallet-address" name="walletAddress" placeholder="0x...">
    </div>
    <button type="submit" class="btn btn-primary">Connect Wallet</button>
    <div id="wallet-message" class="message"></div>
  </form>
</div>

<!-- JavaScript for form handling -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Wait for SDK to be ready
  if (window.jagcode) {
    setupForms();
  } else {
    // Wait for SDK to initialize
    window.addEventListener('load', function() {
      setTimeout(setupForms, 1000);
    });
  }
});

function setupForms() {
  if (!window.jagcode) {
    console.error('JagCode SDK not available');
    return;
  }

  // Login form handler
  const loginForm = document.getElementById('jagcode-login-form');
  if (loginForm) {
    loginForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const messageEl = document.getElementById('login-message');
      
      try {
        loginForm.classList.add('jagcode-loading');
        messageEl.className = 'message';
        messageEl.textContent = 'Signing in...';
        
        await window.jagcode.auth.signIn(email, password);
        
        messageEl.className = 'message jagcode-success';
        messageEl.textContent = 'Login successful!';
        
        // Refresh page to show authenticated content
        setTimeout(() => location.reload(), 1000);
        
      } catch (error) {
        messageEl.className = 'message jagcode-error';
        messageEl.textContent = error.message || 'Login failed';
      } finally {
        loginForm.classList.remove('jagcode-loading');
      }
    });
  }

  // Signup form handler
  const signupForm = document.getElementById('jagcode-signup-form');
  if (signupForm) {
    signupForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const messageEl = document.getElementById('signup-message');
      
      try {
        signupForm.classList.add('jagcode-loading');
        messageEl.className = 'message';
        messageEl.textContent = 'Creating account...';
        
        await window.jagcode.auth.signUp(email, password, name);
        
        messageEl.className = 'message jagcode-success';
        messageEl.textContent = 'Account created successfully!';
        
        // Refresh page to show authenticated content
        setTimeout(() => location.reload(), 1000);
        
      } catch (error) {
        messageEl.className = 'message jagcode-error';
        messageEl.textContent = error.message || 'Signup failed';
      } finally {
        signupForm.classList.remove('jagcode-loading');
      }
    });
  }

  // Signout button handler
  const signoutBtn = document.getElementById('jagcode-signout');
  if (signoutBtn) {
    signoutBtn.addEventListener('click', async function() {
      try {
        await window.jagcode.auth.signOut();
        location.reload();
      } catch (error) {
        console.error('Signout failed:', error);
      }
    });
  }

  // Wallet connect form handler
  const walletForm = document.getElementById('wallet-connect-form');
  if (walletForm) {
    walletForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const walletAddress = document.getElementById('wallet-address').value;
      const messageEl = document.getElementById('wallet-message');
      const user = window.jagcode.auth.getCurrentUser();
      
      if (!user) {
        messageEl.className = 'message jagcode-error';
        messageEl.textContent = 'Please sign in first';
        return;
      }
      
      try {
        walletForm.classList.add('jagcode-loading');
        messageEl.className = 'message';
        messageEl.textContent = 'Connecting wallet...';
        
        // Update user profile with wallet address
        await window.jagcode.db.update('users', user.$id, {
          walletAddress: walletAddress,
          updatedAt: new Date().toISOString()
        });
        
        messageEl.className = 'message jagcode-success';
        messageEl.textContent = 'Wallet connected successfully!';
        
      } catch (error) {
        messageEl.className = 'message jagcode-error';
        messageEl.textContent = error.message || 'Failed to connect wallet';
      } finally {
        walletForm.classList.remove('jagcode-loading');
      }
    });
  }

  // Load user data if authenticated
  const user = window.jagcode.auth.getCurrentUser();
  if (user) {
    loadUserData(user);
  }
}

async function loadUserData(user) {
  try {
    // Load portfolio data
    const portfolioContainer = document.getElementById('portfolio-data');
    if (portfolioContainer) {
      try {
        const portfolio = await window.jagcode.portfolio.get();
        if (portfolio) {
          portfolioContainer.innerHTML = `
            <div class="portfolio-summary">
              <div class="portfolio-value">
                <strong>Total Value: ${window.jagcode.utils.formatCurrency(portfolio.totalValue || 0)}</strong>
              </div>
              <div class="portfolio-assets">
                Assets: ${portfolio.assets?.length || 0}
              </div>
              <div class="portfolio-updated">
                Last Updated: ${window.jagcode.utils.formatDate(portfolio.lastUpdated)}
              </div>
            </div>
          `;
        } else {
          portfolioContainer.innerHTML = '<div class="no-data">No portfolio data available</div>';
        }
      } catch (error) {
        portfolioContainer.innerHTML = '<div class="error">Failed to load portfolio</div>';
      }
    }

    // Load transactions data
    const transactionsContainer = document.getElementById('transactions-data');
    if (transactionsContainer) {
      try {
        const transactions = await window.jagcode.transactions.list(null, 10);
        if (transactions.length > 0) {
          const transactionsList = transactions.map(tx => `
            <div class="transaction-item">
              <div class="transaction-type">${tx.type.toUpperCase()}</div>
              <div class="transaction-amount">${tx.amount} ${tx.symbol}</div>
              <div class="transaction-date">${window.jagcode.utils.formatDate(tx.timestamp)}</div>
            </div>
          `).join('');
          
          transactionsContainer.innerHTML = `<div class="transactions-list">${transactionsList}</div>`;
        } else {
          transactionsContainer.innerHTML = '<div class="no-data">No transactions found</div>';
        }
      } catch (error) {
        transactionsContainer.innerHTML = '<div class="error">Failed to load transactions</div>';
      }
    }
  } catch (error) {
    console.error('Failed to load user data:', error);
  }
}
</script>

<!-- Additional CSS for form styling -->
<style>
.form-field {
  margin-bottom: 16px;
}

.form-field label {
  display: block;
  margin-bottom: 4px;
  font-weight: 600;
}

.form-field input {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  font-size: 14px;
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}

.btn-primary {
  background-color: #3b82f6;
  color: white;
}

.btn-secondary {
  background-color: #6b7280;
  color: white;
}

.message {
  margin-top: 8px;
  font-size: 14px;
}

.portfolio-summary, .transaction-item {
  padding: 12px;
  border: 1px solid #e5e7eb;
  border-radius: 4px;
  margin-bottom: 8px;
}

.no-data, .error {
  padding: 20px;
  text-align: center;
  color: #6b7280;
  font-style: italic;
}

.loading {
  text-align: center;
  color: #6b7280;
  padding: 20px;
}
</style>
